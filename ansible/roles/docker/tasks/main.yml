---
# tasks file for docker

# Docker installation
- name: Include Docker installation tasks
  ansible.builtin.include_tasks: install.yml
  tags:
    - docker
    - docker-install

# Docker daemon.json configuration (for data-root and other settings)
- name: Ensure Docker daemon.json is configured
  ansible.builtin.template:
    src: daemon.json.j2
    dest: /etc/docker/daemon.json
    owner: root
    group: root
    mode: "0644"
  become: true
  notify: Restart docker
  when: (docker.data_root | default('/var/lib/docker')) != "/var/lib/docker" or (docker_daemon_config | default({}) | length > 0)
  tags:
    - docker
    - docker-config

# Data-root migration process
- name: Include Docker data-root migration tasks
  ansible.builtin.include_tasks: migrate_data_root.yml
  when: docker.migrate_data_root | default(false)
  tags:
    - docker
    - docker-migration
