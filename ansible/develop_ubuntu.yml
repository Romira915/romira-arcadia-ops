---
# Play 1: System provisioning (root)
- name: System provisioning
  hosts: develop_ubuntu
  roles:
    - user
    - apt
  tags: develop_ubuntu

# Play 2: Linuxbrew installation
# linuxbrew ロールは内部で become: true (apt) / false (installer) を使い分けるため
# play レベルの become_user と相性が悪い。単独 Play にする
- name: Linuxbrew installation
  hosts: develop_ubuntu
  roles:
    - markosamuli.linuxbrew
  vars:
    linuxbrew_use_installer: true
    linuxbrew_init_shell: false
  tags: develop_ubuntu

# Play 3: User tools provisioning (setup_user)
- name: User tools provisioning
  hosts: develop_ubuntu
  become: true
  become_user: "{{ setup_user }}"
  roles:
    - role: brew
      tags: brew
    - role: bitwarden
      tags: bitwarden
    - role: gh
      tags: gh
  tags: develop_ubuntu

# Play 4: User environment setup (setup_user)
- name: User environment setup
  hosts: develop_ubuntu
  become: true
  become_user: "{{ setup_user }}"
  tasks:
    - import_tasks: tasks/develop_ubuntu/symlink.yml
      tags:
        - develop_configuration
        - symlink

    - import_tasks: tasks/develop_ubuntu/ssh.yml
      tags:
        - develop_configuration
        - ssh

    - import_tasks: tasks/develop_ubuntu/zprezto.yml
      tags:
        - develop_configuration
        - zprezto

    - import_tasks: tasks/develop_ubuntu/fish.yml
      tags:
        - develop_configuration
        - fish

    - import_tasks: tasks/develop_ubuntu/rustup.yml
      tags:
        - develop_configuration
        - rustup

    - import_tasks: tasks/develop_ubuntu/tmux.yml
      tags:
        - develop_configuration
        - tmux
  tags:
    - develop_configuration

# Play 5: WSL configuration
- name: Set up only wsl configuration
  hosts: develop_ubuntu
  become: true
  become_user: "{{ setup_user }}"
  tasks:
    - import_tasks: tasks/develop_ubuntu/wsl.yml
      tags:
        - develop_configuration
        - wsl
        - symlink
  tags:
    - develop_configuration
