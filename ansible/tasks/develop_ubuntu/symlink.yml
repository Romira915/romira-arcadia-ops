---
- name: Ensure directory is exists
  ansible.builtin.file:
    path: "{{ item }}"
    state: directory
    mode: "0755"
  loop: "{{ develop_configuration.directories }}"

- name: Check symlink destinations
  ansible.builtin.stat:
    path: "{{ item.dest }}"
  loop: "{{ develop_configuration.symbolic_links }}"
  loop_control:
    label: "{{ item.dest }}"
  register: symlink_dest_stats

- name: Remove existing directories that will become symlinks
  ansible.builtin.file:
    path: "{{ item.item.dest }}"
    state: absent
  loop: "{{ symlink_dest_stats.results }}"
  loop_control:
    label: "{{ item.item.dest }}"
  when: item.stat.exists and item.stat.isdir and not item.stat.islnk

- name: Create symbolic links
  ansible.builtin.file:
    src: "{{ item.src }}"
    dest: "{{ item.dest }}"
    state: link
    force: true
  loop: "{{ develop_configuration.symbolic_links }}"

- name: Ensure ~/.claude/skills directory exists
  ansible.builtin.file:
    path: ~/.claude/skills
    state: directory
    mode: "0755"

- name: Find claude skill files
  ansible.builtin.find:
    paths: ~/.config/romira-s-config/claude-code/skills
    patterns: "*"
    file_type: any
  register: claude_skill_files

- name: Create symbolic links for claude skills
  ansible.builtin.file:
    src: "{{ item.path }}"
    dest: "~/.claude/skills/{{ item.path | basename }}"
    state: link
    force: true
  loop: "{{ claude_skill_files.files }}"
  loop_control:
    label: "{{ item.path | basename }}"
